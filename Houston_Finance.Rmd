---
title: "Houston_Finance"
output: html_document
date: "2024-06-03"
---


Name: Michael Zhang
Contact Info: 832-726-2026
Date: 6/3/2024
# Who’s meddling in your elections:


A minority of large donors have always held huge influence in Houston elections. In the recent mayoral race, current mayor of Houston John Whitmire held a huge advantage during the race with his “war chest” campaign funding. With ##$## 9 million dollars from donations, his funding pool was [30 times](https://www.houstonchronicle.com/politics/houston/article/whitmire-s-spending-houston-mayor-race-double-18453375.php) the size of any of his competitors’ in the Houston mayoral race.


This trend doesn’t end with Whitmire either. Various incumbent Houston city council members, judges, and elected constables all have records showing large donations from unknown, and often out-of-state donors. Yet little information exists online about who these donors are, and more importantly, what their motivations are to funding local Houston politicians. 

Records: The data for this project comes from [The City of Houston Open Data](https://data.houstontx.gov/), which is updated and maintained by 

##explain where you are getting the data and provide a link ## By examining a datasheet listing all the candidates, amounts, and donor information, we can hopefully shed some more light on the background and motivation of local political donors. While the sheet has lacked sufficient updating, and its most recent update was in 2018, a lot of the individuals listed in the document are still currently in office, and it would be interesting to see where they get all their campaign money.

Visuals: A map plotting out all the locations of people who have contributed to local elections in Houston politics, just from a preliminary examination, it looks like there are alot of donors who are from cities outside the state like San Francisco, Michigan, etc.

Impact: This project will hopefully improve transparency on who our local elected officials are funded by and how much influence these donors have over their political decisions.

Surprising findings from the story: 
1. It was interesting to see that there are a high number of donors from outside state lines. While some could be just friends of the politicians, some of the donors were CEOs of large companies, which would be interesting to research further, and try to find how they influence politicians' decisions.

2. There were also a high number of donors from big oil companies, which is to be expected for Texas, but it would be interesting to see how the city council members voted on oil legislation as well. 

3. Also this could be another story, covering how the lack of transparency for this data. The excel sheet I retrieved was not updated properly, and when I called the city of Houston secretary, they didn’t even know the database listed on their website existed. 

Estimated delivery: 
June 10-15

Question: Who is funding local Houston political candidates?

installing basic packages if needed

```{r}
#install.packages("openxlsx")
#install.packages("tidyverse")
#install.packages("rio")
#install.packages("janitor")
#install.packages("dplyr")
```

## R Markdown

loading in necessary packages
```{r}
library(tidyverse)
library(rio)
library(janitor)
library(dplyr)
library(openxlsx)
```

reading in the data

```{r}
Campaign_data <- read_csv("campaign_finance.csv")
```

#RSW comment - let's figure out what this limit is all about: Exceeded $500 limit
#RSW comment - 8th day before election


looking at summary of data
```{r}
head(Campaign_data)

#RSW comment - look at this table below on the details of the types of donations. This is important to know these different categories
Campaign_data %>% 
   count(MasterTransactionType) %>% 
  arrange(desc(n))

```
now I filtered for current incumbents that appeared on the campaign spreadsheet, creating a new spreadsheet for each individuals table

Some of the names had multiple formats, so I have some variables listing their different formats

#RSW comment - I would do a single summary table and have these candidates and their money for a single year

```{r}
Sallie_Alcorn <- Campaign_data %>% filter(CandidateFullName %in% "Sallie Alcorn")
Willie_R_Davis <- Campaign_data %>% filter(CandidateFullName == "Willie R Davis")
Martha_Castex_Tatum <- Campaign_data %>% filter(CandidateFullName == "Martha Castex-Tatum")
Mr_Edward_J_Pollard <- Campaign_data %>% filter(CandidateFullName == "Mr. Edward J Pollard")
Adrian_Garcia <- Campaign_data %>% filter(CandidateFullName == "Adrian Garcia")
Dr_Carolyn_Evans_Shabazz <- Campaign_data %>% filter(CandidateFullName == "Dr. Carolyn Evans-Shabazz")
amy_peck_variants <- c("Ms. Amy Peck", "Ms. Amy L Peck", "Mrs. Amy Peck")
Amy_Peck <- Campaign_data %>% filter(CandidateFullName %in% amy_peck_variants)
edward_gonzalez_variants <- c("Mr. Edward Ed Gonzalez", "Edward Edward Gonzalez", "Edward Ed Gonzalez")
Edward_Gonzalez <- Campaign_data %>% filter(CandidateFullName %in% edward_gonzalez_variants)

```


sort the data by donation amount, I also had to change the column type from character to int:

```{r}
# Amy_Peck
Amy_Peck$TransactionAmount <- as.numeric(Amy_Peck$TransactionAmount)
Amy_Peck <- Amy_Peck %>% arrange(desc(TransactionAmount))

# Willie_R_Davis
Willie_R_Davis$TransactionAmount <- as.numeric(Willie_R_Davis$TransactionAmount)
Willie_R_Davis <- Willie_R_Davis %>% arrange(desc(TransactionAmount))

# Martha_Castex_Tatum
Martha_Castex_Tatum$TransactionAmount <- as.numeric(Martha_Castex_Tatum$TransactionAmount)
Martha_Castex_Tatum <- Martha_Castex_Tatum %>% arrange(desc(TransactionAmount))

# Mr_Edward_J_Pollard
Mr_Edward_J_Pollard$TransactionAmount <- as.numeric(Mr_Edward_J_Pollard$TransactionAmount)
Mr_Edward_J_Pollard <- Mr_Edward_J_Pollard %>% arrange(desc(TransactionAmount))

# Adrian_Garcia
Adrian_Garcia$TransactionAmount <- as.numeric(Adrian_Garcia$TransactionAmount)
Adrian_Garcia <- Adrian_Garcia %>% arrange(desc(TransactionAmount))

# Dr_Carolyn_Evans_Shabazz
Dr_Carolyn_Evans_Shabazz$TransactionAmount <- as.numeric(Dr_Carolyn_Evans_Shabazz$TransactionAmount)
Dr_Carolyn_Evans_Shabazz <- Dr_Carolyn_Evans_Shabazz %>% arrange(desc(TransactionAmount))

# Edward_Gonzalez
Edward_Gonzalez$TransactionAmount <- as.numeric(Edward_Gonzalez$TransactionAmount)
Edward_Gonzalez <- Edward_Gonzalez %>% arrange(desc(TransactionAmount))

# Sallie_Alcorn
Sallie_Alcorn$TransactionAmount <- as.numeric(Sallie_Alcorn$TransactionAmount)
Sallie_Alcorn <- Sallie_Alcorn %>% arrange(desc(TransactionAmount))
```


Check that the candidate spreadsheet was properly sorted based on the transaction amount


```{r}
result <- Sallie_Alcorn %>% 
  select(CampaignYear, TransactionAmount, TransactionPartyFullName, TransactionPartyEmployer, OfficeSought, TransactionAddressStreet, TransactionPartyCity, TransactionPartyOccupation) %>% 
  group_by(TransactionAmount)
write.xlsx(result, file = "Sallie_Alcorn_Transactions.xlsx")


```

now we have each of the incumbent candidates with their own spreadsheet of donors, sorted by the transaction amount from highest to lowest, we wont use that for now

create a incumbent transactions variable, use a secondary software to clean the naming conventions
```{r}
incumbent_transactions <- read_csv("incumbent_transactions_cleaned.csv")
```



Let's filter our data to only include contributions and get rid of NAs (FOR NOW -- you'll want to explore the records that contain NAs and see if you can figure out why they're there, and make sure we're not losing something important by filtering these records out)

```{r}
contributions_to_incumbents <- incumbent_transactions %>%
  filter(transaction_type %in% c("Political Contributions", "Monetary Political Contributions")) %>%
  filter(!is.na(transaction_amount))
  
```

A few candidates' names show up as multiple values. We can use case_when() to standardize them.

```{r}
contributions_to_incumbents <- contributions_to_incumbents %>%
  mutate(candidate_full_name = case_when(
    candidate_full_name == "Mr. Edward Ed Gonzalez" ~ "Edward Ed Gonzalez",
    candidate_full_name == "Mrs. Amy Peck" ~ "Ms. Amy Peck",
    candidate_full_name == "Ms. Amy L Peck" ~ "Ms. Amy Peck",
    .default = candidate_full_name
  ))
```


group all contributions by person and get the sum for each person.

```{r}
contr_sums_per_cand <- contributions_to_incumbents %>%
  group_by(candidate_full_name) %>%
  summarise(total_contributions = sum(transaction_amount)) %>%
  arrange(desc(total_contributions))

contr_sums_per_cand


```



```{r}

In_state_table <- contributions_to_incumbents %>%
  group_by(candidate_full_name) %>%
  filter(str_detect(transaction_party_state, "TX")) %>%
  summarise(In_state_contributions = sum(transaction_amount)) %>%
  arrange(desc(In_state_contributions))


print(In_state_table)

```

```{r}
Instate_outstate_comparison <- left_join(In_state_table, contr_sums_per_cand, by = "candidate_full_name")
Instate_outstate_comparison <- Instate_outstate_comparison %>%
  mutate(in_state_percentage = In_state_contributions
 / total_contributions)
print(Instate_outstate_comparison)
```



```{r}
contr_sums_per_cand <- contributions_to_incumbents %>%
  group_by(candidate_full_name) %>%
  summarise(total_contributions = sum(transaction_amount)) %>%
  arrange(desc(total_contributions))

contr_sums_per_cand


```



```{r}
contr_sums_per_cand <- contributions_to_incumbents %>%
  group_by(candidate_full_name) %>%
  summarise(total_contributions = sum(transaction_amount)) %>%
  arrange(desc(total_contributions))

In_city_table <- contributions_to_incumbents %>%
  group_by(candidate_full_name) %>%
  filter(str_detect(transaction_party_city, "Houston")) %>%
  summarise(In_City_Contributions = sum(transaction_amount)) %>%
  arrange(desc(In_City_Contributions))

InCity_OutCity_comparison <- left_join(In_city_table, contr_sums_per_cand, by = "candidate_full_name")
InCity_OutCity_comparison <- InCity_OutCity_comparison %>%
  mutate(in_city_percentage = In_City_Contributions
 / total_contributions)
print(InCity_OutCity_comparison)
```
now write the csv's out

```{r}
write.csv(Instate_outstate_comparison, "inState_outState_comparison.csv", row.names = FALSE)
write.csv(InCity_OutCity_comparison, "inCity_outCity_comparison.csv", row.names = FALSE)

```


the graphs displayed using data wrapper: 

<iframe title="Percentage of out of city contributions to politican campaigns" aria-label="Column Chart" id="datawrapper-chart-QEBOz" src="https://datawrapper.dwcdn.net/QEBOz/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="470" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();</script>

<iframe title="" aria-label="Grouped Columns" id="datawrapper-chart-fVqiA" src="https://datawrapper.dwcdn.net/fVqiA/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="443" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r=0;r<e.length;r++)if(e[r].contentWindow===a.source){var i=a.data["datawrapper-height"][t]+"px";e[r].style.height=i}}}))}();</script>


The following graphs highlight a couple of these candidates, especially Adrian Garcia, who have high out of city campaign donators, it would be interested to see who these people are. 
